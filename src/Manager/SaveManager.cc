#include "SaveManager.hpp"
#include <string.h>
#include <cstdio>

SaveManager::SaveManager()
{
    this->nextStage = 0;
    this->nextLevel = 0;
    this->saveFlags = 0;
    this->lastStageStatus = 0;
    this->dwordC = 0;

    memset(&this->rawSaveData, 0, sizeof(this->rawSaveData));

    FILE* saveFile = fopen("bpfdat.dat", "rb");

    if (saveFile != nullptr)
    {
        fread(&this->rawSaveData, sizeof(this->rawSaveData), 1, saveFile);
        fclose(saveFile);

        // TODO: Process save data
    }
    else
    {
        // Copy header
        memcpy(&this->rawSaveData[0], &this->defaultSaveData[0], 4);

        for (int i = 0; i < 40; i++)
        {
            // TODO: Block copy
        }

        memcpy(&this->rawSaveData[484], &this->defaultSaveData[484], 2);
        memcpy(&this->rawSaveData[488], &this->defaultSaveData[488], 4);

        for (int i = 0; i < 16; i++)
        {
            // TODO: Block copy
        }
    }

    this->CreatePlayerObjects();
}

void SaveManager::CreatePlayerObjects()
{
    this->playerObject1.Initialize();
    this->playerObject2.Initialize();
}

Save_PlayerObject::Save_PlayerObject()
{
}

void Save_PlayerObject::Initialize()
{
    this->characterSelected = -1;
    this->dword4 = 0;
    this->word8 = 8;
}

const uint8_t SaveManager::defaultSaveData[] = { 0x42, 0x50, 0x46, 0x31, 0x00, 0x00, 0x0D, 0x00, 0x24, 0x00, 0x22, 0x00, 0x0A, 0x00, 0x16, 0x00, 0x0A, 0x00, 0x25, 0x00, 0x25, 0x00, 0x00, 0x00, 0xA0, 0x86, 0x01, 0x00, 0x01, 0x00, 0x0D, 0x00, 0x24, 0x00, 0x22, 0x00, 0x0A, 0x00, 0x16, 0x00, 0x0A, 0x00, 0x25, 0x00, 0x25, 0x00, 0x00, 0x00, 0x90, 0x5F, 0x01, 0x00, 0x00, 0x00, 0x0D, 0x00, 0x24, 0x00, 0x22, 0x00, 0x0A, 0x00, 0x16, 0x00, 0x0A, 0x00, 0x25, 0x00, 0x25, 0x00, 0x00, 0x00, 0x80, 0x38, 0x01, 0x00, 0x01, 0x00, 0x0D, 0x00, 0x24, 0x00, 0x22, 0x00, 0x0A, 0x00, 0x16, 0x00, 0x0A, 0x00, 0x25, 0x00, 0x25, 0x00, 0x00, 0x00, 0x70, 0x11, 0x01, 0x00, 0x00, 0x00, 0x0D, 0x00, 0x24, 0x00, 0x22, 0x00, 0x0A, 0x00, 0x16, 0x00, 0x0A, 0x00, 0x25, 0x00, 0x25, 0x00, 0x00, 0x00, 0x60, 0xEA, 0x00, 0x00, 0x01, 0x00, 0x0D, 0x00, 0x24, 0x00, 0x22, 0x00, 0x0A, 0x00, 0x16, 0x00, 0x0A, 0x00, 0x25, 0x00, 0x25, 0x00, 0x00, 0x00, 0x50, 0xC3, 0x00, 0x00, 0x00, 0x00, 0x0D, 0x00, 0x24, 0x00, 0x22, 0x00, 0x0A, 0x00, 0x16, 0x00, 0x0A, 0x00, 0x25, 0x00, 0x25, 0x00, 0x00, 0x00, 0x40, 0x9C, 0x00, 0x00, 0x01, 0x00, 0x0D, 0x00, 0x24, 0x00, 0x22, 0x00, 0x0A, 0x00, 0x16, 0x00, 0x0A, 0x00, 0x25, 0x00, 0x25, 0x00, 0x00, 0x00, 0x30, 0x75, 0x00, 0x00, 0x00, 0x00, 0x0D, 0x00, 0x24, 0x00, 0x22, 0x00, 0x0A, 0x00, 0x16, 0x00, 0x0A, 0x00, 0x25, 0x00, 0x25, 0x00, 0x00, 0x00, 0x20, 0x4E, 0x00, 0x00, 0x01, 0x00, 0x0D, 0x00, 0x24, 0x00, 0x22, 0x00, 0x0A, 0x00, 0x16, 0x00, 0x0A, 0x00, 0x25, 0x00, 0x25, 0x00, 0x00, 0x00, 0x10, 0x27, 0x00, 0x00, 0x00, 0x00, 0x0D, 0x00, 0x24, 0x00, 0x22, 0x00, 0x0A, 0x00, 0x16, 0x00, 0x0A, 0x00, 0x25, 0x00, 0x25, 0x00, 0x00, 0x00, 0xA0, 0x86, 0x01, 0x00, 0x01, 0x00, 0x0D, 0x00, 0x24, 0x00, 0x22, 0x00, 0x0A, 0x00, 0x16, 0x00, 0x0A, 0x00, 0x25, 0x00, 0x25, 0x00, 0x00, 0x00, 0x90, 0x5F, 0x01, 0x00, 0x00, 0x00, 0x0D, 0x00, 0x24, 0x00, 0x22, 0x00, 0x0A, 0x00, 0x16, 0x00, 0x0A, 0x00, 0x25, 0x00, 0x25, 0x00, 0x00, 0x00, 0x80, 0x38, 0x01, 0x00, 0x01, 0x00, 0x0D, 0x00, 0x24, 0x00, 0x22, 0x00, 0x0A, 0x00, 0x16, 0x00, 0x0A, 0x00, 0x25, 0x00, 0x25, 0x00, 0x00, 0x00, 0x70, 0x11, 0x01, 0x00, 0x00, 0x00, 0x0D, 0x00, 0x24, 0x00, 0x22, 0x00, 0x0A, 0x00, 0x16, 0x00, 0x0A, 0x00, 0x25, 0x00, 0x25, 0x00, 0x00, 0x00, 0x60, 0xEA, 0x00, 0x00, 0x01, 0x00, 0x0D, 0x00, 0x24, 0x00, 0x22, 0x00, 0x0A, 0x00, 0x16, 0x00, 0x0A, 0x00, 0x25, 0x00, 0x25, 0x00, 0x00, 0x00, 0x50, 0xC3, 0x00, 0x00, 0x00, 0x00, 0x0D, 0x00, 0x24, 0x00, 0x22, 0x00, 0x0A, 0x00, 0x16, 0x00, 0x0A, 0x00, 0x25, 0x00, 0x25, 0x00, 0x00, 0x00, 0x40, 0x9C, 0x00, 0x00, 0x01, 0x00, 0x0D, 0x00, 0x24, 0x00, 0x22, 0x00, 0x0A, 0x00, 0x16, 0x00, 0x0A, 0x00, 0x25, 0x00, 0x25, 0x00, 0x00, 0x00, 0x30, 0x75, 0x00, 0x00, 0x00, 0x00, 0x0D, 0x00, 0x24, 0x00, 0x22, 0x00, 0x0A, 0x00, 0x16, 0x00, 0x0A, 0x00, 0x25, 0x00, 0x25, 0x00, 0x00, 0x00, 0x20, 0x4E, 0x00, 0x00, 0x01, 0x00, 0x0D, 0x00, 0x24, 0x00, 0x22, 0x00, 0x0A, 0x00, 0x16, 0x00, 0x0A, 0x00, 0x25, 0x00, 0x25, 0x00, 0x00, 0x00, 0x10, 0x27, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0A, 0x00, 0x00, 0x00, 0x0E, 0x00, 0x1B, 0x00, 0x20, 0x00, 0x1A, 0x00, 0x0F, 0x00, 0x1F, 0x00, 0x0C, 0x00, 0x0B, 0x00, 0x28, 0x00, 0x29, 0x00, 0x27, 0x00, 0x15, 0x00, 0x2E, 0x00, 0x2F, 0x00, 0x30, 0x00, 0x31, 0x00 };
